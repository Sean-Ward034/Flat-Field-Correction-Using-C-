# **Advanced Flat Field Correction Application**

## **Project Overview**

This project is a C# Windows Forms application that implements an advanced flat field correction algorithm to process and correct non-uniform images. The application simulates a dark frame and bright field images based on the uploaded object image, making it easier for users to perform flat field correction without requiring additional calibration images. Users can now manually fine-tune image properties like brightness, contrast, and exposure using interactive sliders.

### **Features:**
1. **Automatic Dark and Bright Field Generation**: 
   - Generates dark and bright field calibration images automatically based on the uploaded object image.
   
2. **Advanced Flat Field Correction Algorithm**:
   - Implements gain and offset adjustments based on mean intensity calculations.
   
3. **Gaussian Smoothing for Noise Reduction**:
   - Applies Gaussian smoothing to the dark and bright field images to reduce noise and improve correction quality.

4. **Interactive User Interface**:
   - A simple and intuitive UI for uploading images, applying corrections, and visualizing results side-by-side.

5. **Manual Image Adjustment**:
   - Users can manually adjust brightness, contrast, and exposure using sliders after the initial correction has been applied.

6. **Save or Discard Changes**:
   - Once manual adjustments are complete, users can either save the changes or discard them, reverting to the originally corrected image.

## **How It Works**

### **1. Flat Field Correction Theory**

Flat field correction is a technique used in imaging to correct for non-uniformities in the captured image, which arise due to variations in the sensor's response and the illumination setup. These non-uniformities can cause shadows, gradients, and noise in the image, affecting the quality and accuracy of the data. Flat field correction works by compensating for these artifacts using two calibration images:

- **Dark Frame**: Captures the sensor's noise and imperfections in the absence of light (e.g., with the camera shutter closed).
- **Bright Field**: Captures the sensor's response under uniform illumination.

The flat field correction formula is typically defined as:

```
Corrected Image = ((R - D) / (F - D)) * G
```

Where:
- `R` is the raw image (object image).
- `D` is the dark frame image.
- `F` is the bright field image.
- `G` is a gain factor, typically set to the maximum pixel intensity (e.g., 255).

This formula ensures that pixel values are normalized based on the sensor's noise and illumination variations, resulting in a more uniform and accurate image.

### **2. How This Application Implements Flat Field Correction**

This application automatically generates the dark and bright field images using the uploaded object image and performs flat field correction based on the following steps:

1. **Object Image Upload**:
   - The user uploads the image they want to correct. This image is displayed in the left picture box of the UI.
   
2. **Automatic Dark and Bright Field Generation**:
   - A **Dark Frame** is generated by reducing the brightness of each pixel in the object image by 80%, simulating a low-light or noise-only scenario.
   - A **Bright Field** is generated by increasing the brightness of each pixel in the object image by 50%, simulating a uniformly lit image.

3. **Smoothing and Preprocessing**:
   - Gaussian smoothing is applied to both dark and bright field images to minimize noise and improve correction quality.

4. **Flat Field Correction Algorithm**:
   - The algorithm calculates the mean intensity of both the dark and bright field images.
   - Gain and offset adjustments are computed using these mean intensities.
   - Each pixel in the object image is corrected based on the calculated gain, offset, and the formula mentioned earlier.

5. **Manual Image Adjustments**:
   - Once the correction is applied, the user can further fine-tune the image using interactive sliders for **brightness**, **contrast**, and **exposure**.
   - Changes can be previewed in real-time.

6. **Save or Discard Changes**:
   - After adjusting the image, users can either save their changes, which will update the corrected image, or discard changes to revert to the original correction.

7. **Visualization**:
   - The corrected image is displayed in the right picture box, allowing the user to compare the results.

## **File Structure**

The repository contains the following main files:

- **`Form1.cs`**: Contains the main logic for image upload, flat field correction, manual adjustments, and UI updates.
- **`Program.cs`**: Entry point for the application.
- **`Form1.Designer.cs`**: UI component definitions for the Windows Forms application.
- **`README.md`**: Documentation file (this file).

## **How to Run the Application**

### **Requirements:**
- **.NET Framework 4.7.2** or higher (if using .NET Framework)
- **Visual Studio** (recommended IDE)

### **Steps:**
1. Clone the repository or download the project files.
2. Open the solution (`.sln`) file in Visual Studio.
3. Build the solution (`Build` > `Build Solution`).
4. Run the application (`Start` or `F5`).
5. Use the **Upload Image** button to select the object image.
6. Click **Apply Correction** to view the corrected image.
7. Click **Edit Correction** to enable manual adjustments.
8. Use the sliders to adjust brightness, contrast, and exposure.
9. Click **Save Changes** or **Discard Changes** to finalize your adjustments.

### **Creating the Executable (.exe) File:**
1. Set the build configuration to `Release` in Visual Studio.
2. Build the project (`Build` > `Build Solution`).
3. Navigate to the `bin\Release\` directory to find the `FlatFieldCorrectionApp.exe` file.

## **Technical Details**

### **1. Dark and Bright Field Generation**
- The application simulates the dark and bright fields using static brightness adjustments:
  - **Dark Field**: Brightness reduced by 80%.
  - **Bright Field**: Brightness increased by 50%.
  
This simulation is effective for basic flat field correction but may not capture all real-world nuances of a dark and bright field.

### **2. Manual Adjustments**
- Users can manually adjust **brightness**, **contrast**, and **exposure** after the initial correction using sliders.
- The changes can be previewed in real-time.

### **3. Save or Discard Changes**
- The manual changes can be saved to update the corrected image, or discarded to restore the original corrected version.

## **Sources and Citations**

1. **Wikipedia**:
   - Flat Field Correction Theory: [Flat Field Correction - Wikipedia](https://en.wikipedia.org/wiki/Flat-field_correction).
   
2. **Adimec**:
   - In-Field Calibrations for Machine Vision: [Adimec Resource on Flat Field Correction](https://www.adimec.com/in-field-calibrations-for-optimal-machine-vision-image-accuracy).

3. **MathWorks**:
   - Advanced Image Processing Techniques: [MathWorks Guide](https://www.mathworks.com/help/images/flat-field-correction.html).

## **Future Enhancements**

1. **Advanced Adjustment Options**:
   - Include additional adjustments like gamma correction, saturation, and hue shifts.

2. **Automatic Parameter Optimization**:
   - Implement machine learning techniques to automatically determine optimal brightness and contrast settings.

3. **Support for Different Color Models**:
   - Add support for adjustments in HSV or LAB color spaces for more fine-grained control.

Feel free to modify and enhance the project as needed!
